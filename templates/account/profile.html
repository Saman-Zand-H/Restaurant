{% extends 'base/layout/dash_base.html' %} 

{% load static %}


{% block title %}{{ user.username|title }}'s Profile{% endblock %} 

{% block stylesheet %}
{{ address_form.media }}
{% endblock %}

{% block content %}
	<div class="row">
		<div class="col-md-8">
			<div class="card">
				<div class="card-header card-header-primary">
					<h4 class="card-title">Edit Profile</h4>
					<p class="card-category">Complete your profile</p>
				</div>
				<div class="card-body">
					<form>
						<div class="row mt-3">
							<div class="col-md-6">
								<div class="form-group">
									<label class="bmd-label-floating"
										>Fist Name</label
									>
									<input type="text" class="form-control" value="{{ user.first_name }}">
								</div>
							</div>
							<div class="col-md-6">
								<div class="form-group">
									<label class="bmd-label-floating"
										>Last Name</label
									>
									<input type="text" class="form-control" value="{{ user.last_name }}">
								</div>
							</div>
						</div>
						<button type="submit" class="btn btn-primary pull-right">
							Update
						</button>
						<div class="clearfix"></div>
					</form>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<div class="card card-profile">
				<div class="card-avatar">
					<a href="#pablo">
						<img
							class="img"
							src="{% static 'dash_assets/img/faces/marc.jpg' %}"
						/>
					</a>
				</div>
				<div class="card-body">
					<h6 class="card-category">CEO / Co-Founder</h6>
					<h4 class="card-title">Alec Thompson</h4>
					<p class="card-description">
						Don't be scared of the truth because we need to restart the
						human foundation in truth And I love you like Kanye loves
						Kanye I love Rick Owens' bed design but the back is...
					</p>
					<a href="#pablo" class="btn btn-primary btn-round">Follow</a>
				</div>
			</div>
		</div>
        <div class="card" id="addressesCard">
				<div class="card-header card-header-primary">
					<h4 class="card-title">Edit Addresses</h4>
					<p class="card-category">Complete your list of addresses</p>
				</div>
				<div class="card-body">
					<div class="mx-3">
						{% for address in user.user_addresses.all %}
						<div class="d-flex" style="gap: .3rem">
							<i class="material-icons text-success">check_circle</i>
							<span class="align-self-baseline">
								<h6>
									{{ address.province }},
									{{ address.city }},
									{{ address.address }} - {{ address.postal_code }}
								</h6>
							</span>
							<span class="align-self-baseline">
								<form method="POST" id="form-{{ address.public_uuid }}">
									{% csrf_token %}
									<input 
										   type="hidden" 
										   name="public_uuid" 
										   value="{{ address.public_uuid }}"
										  >
									<a 
									   href="#addressesCard" 
									   onclick="document.getElementById('form-{{ address.public_uuid }}').submit()"
									  >
									  Edit
									</a>
								</form>
							</span>
							<span class="align-self-baseline">
								<form 
									  method="POST" 
									  id="form-delete-{{ address.public_uuid }}"
									  action="{% url 'accounts:delete_address' %}"
									 >
									{% csrf_token %}
									<input 
										   type="hidden" 
										   name="public_uuid" 
										   value="{{ address.public_uuid }}"
										  >
									<a 
									   href="#addressesCard" 
									   onclick="document.getElementById('form-delete-{{ address.public_uuid }}').submit()"
									  >
									  Delete
									</a>
								</form>
							</span>
						</div>
						{% endfor %}
					</div>
					<hr><div>
						<form 
							  enctype="multipart/form-data" 
							  action="{{ address_form_action }}"
							  method="POST">
							{% csrf_token %}

							{% comment %} 
								This if statement helps us recognize if the form 
								is to create a new record or update a previously created one.
							{% endcomment %}

							{% if public_uuid %}
								<input
								   type="hidden"
								   name="public_uuid"
								   value="{{ public_uuid }}"
								  >
							{% endif %}

							<div class="row">
								<div class="col offset-lg-2 offset-md-2">
									{{ address_form.location }}
								</div>
							</div>
							<div class="row my-2 mx-3">
								<div class="col-lg-4 col-12 form-group">
									<label class="bmd-label-floating">
										City
									</label>
									{{ address_form.city }}
								</div>
								<div class="col-lg-4 col-12 form-group">
									<label class="bmd-label-floating">
										Province
									</label>
									{{ address_form.province }}
								</div>
								<div class="col-lg-4 col-12 form-group">
									<label class="bmd-label-floating">
										Postal Code
									</label>
									{{ address_form.postal_code }}
								</div>
							</div>
							<div class="row my-2 mx-3">
								<div class="col form-group">
									<label class="bmd-label-floating">
										Address
									</label>
									{{ address_form.address }}
								</div>
							</div>
							<button type="submit" class="btn btn-primary pull-right">
								Add
							</button>
							<div class="clearfix"></div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %} 

{% block script %}
	<script>
		$(document).ready(function () {
			$().ready(function () {
				$sidebar = $(".sidebar");

				$sidebar_img_container = $sidebar.find(".sidebar-background");

				$full_page = $(".full-page");

				$sidebar_responsive = $("body > .navbar-collapse");

				window_width = $(window).width();

				$(".fixed-plugin a").click(function (event) {
					// Alex if we click on switch, stop propagation of the event, so the dropdown will not be hide, otherwise we set the  section active
					if ($(this).hasClass("switch-trigger")) {
						if (event.stopPropagation) {
							event.stopPropagation();
						} else if (window.event) {
							window.event.cancelBubble = true;
						}
					}
				});

				$(".fixed-plugin .active-color span").click(function () {
					$full_page_background = $(".full-page-background");

					$(this).siblings().removeClass("active");
					$(this).addClass("active");

					var new_color = $(this).data("color");

					if ($sidebar.length != 0) {
						$sidebar.attr("data-color", new_color);
					}

					if ($full_page.length != 0) {
						$full_page.attr("filter-color", new_color);
					}

					if ($sidebar_responsive.length != 0) {
						$sidebar_responsive.attr("data-color", new_color);
					}
				});

				$(".fixed-plugin .background-color .badge").click(function () {
					$(this).siblings().removeClass("active");
					$(this).addClass("active");

					var new_color = $(this).data("background-color");

					if ($sidebar.length != 0) {
						$sidebar.attr("data-background-color", new_color);
					}
				});

				$(".fixed-plugin .img-holder").click(function () {
					$full_page_background = $(".full-page-background");

					$(this).parent("li").siblings().removeClass("active");
					$(this).parent("li").addClass("active");

					var new_image = $(this).find("img").attr("src");

					if (
						$sidebar_img_container.length != 0 &&
						$(".switch-sidebar-image input:checked").length != 0
					) {
						$sidebar_img_container.fadeOut("fast", function () {
							$sidebar_img_container.css(
								"background-image",
								'url("' + new_image + '")'
							);
							$sidebar_img_container.fadeIn("fast");
						});
					}

					if (
						$full_page_background.length != 0 &&
						$(".switch-sidebar-image input:checked").length != 0
					) {
						var new_image_full_page = $(
							".fixed-plugin li.active .img-holder"
						)
							.find("img")
							.data("src");

						$full_page_background.fadeOut("fast", function () {
							$full_page_background.css(
								"background-image",
								'url("' + new_image_full_page + '")'
							);
							$full_page_background.fadeIn("fast");
						});
					}

					if ($(".switch-sidebar-image input:checked").length == 0) {
						var new_image = $(".fixed-plugin li.active .img-holder")
							.find("img")
							.attr("src");
						var new_image_full_page = $(
							".fixed-plugin li.active .img-holder"
						)
							.find("img")
							.data("src");

						$sidebar_img_container.css(
							"background-image",
							'url("' + new_image + '")'
						);
						$full_page_background.css(
							"background-image",
							'url("' + new_image_full_page + '")'
						);
					}

					if ($sidebar_responsive.length != 0) {
						$sidebar_responsive.css(
							"background-image",
							'url("' + new_image + '")'
						);
					}
				});

				$(".switch-sidebar-image input").change(function () {
					$full_page_background = $(".full-page-background");

					$input = $(this);

					if ($input.is(":checked")) {
						if ($sidebar_img_container.length != 0) {
							$sidebar_img_container.fadeIn("fast");
							$sidebar.attr("data-image", "#");
						}

						if ($full_page_background.length != 0) {
							$full_page_background.fadeIn("fast");
							$full_page.attr("data-image", "#");
						}

						background_image = true;
					} else {
						if ($sidebar_img_container.length != 0) {
							$sidebar.removeAttr("data-image");
							$sidebar_img_container.fadeOut("fast");
						}

						if ($full_page_background.length != 0) {
							$full_page.removeAttr("data-image", "#");
							$full_page_background.fadeOut("fast");
						}

						background_image = false;
					}
				});

				$(".switch-sidebar-mini input").change(function () {
					$body = $("body");

					$input = $(this);

					if (md.misc.sidebar_mini_active == true) {
						$("body").removeClass("sidebar-mini");
						md.misc.sidebar_mini_active = false;

						$(
							".sidebar .sidebar-wrapper, .main-panel"
						).perfectScrollbar();
					} else {
						$(
							".sidebar .sidebar-wrapper, .main-panel"
						).perfectScrollbar("destroy");

						setTimeout(function () {
							$("body").addClass("sidebar-mini");

							md.misc.sidebar_mini_active = true;
						}, 300);
					}

					// we simulate the window Resize so the charts will get updated in realtime.
					var simulateWindowResize = setInterval(function () {
						window.dispatchEvent(new Event("resize"));
					}, 180);

					// we stop the simulation of Window Resize after the animations are completed
					setTimeout(function () {
						clearInterval(simulateWindowResize);
					}, 1000);
				});
			});
		});
	</script>
{% endblock %}
